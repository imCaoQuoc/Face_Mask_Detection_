<!DOCTYPE html>
<html>
<head>
    <title>Face Mask Detection</title>
</head>
<body>
    <h1>Face Mask Detection</h1>
    <p>Welcome to the Face Mask Detection system.</p>
    
    <canvas id="canvas" width="640" height="480"></canvas>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const videoElement = document.createElement('video');
        let streaming = false;

        async function startVideo() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoElement.srcObject = stream;
                videoElement.play();
                streaming = true;
                detect();
            } catch (error) {
                console.error('Error accessing webcam:', error);
            }
        }

        function detect() {
            if (!streaming) return;

            ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

            // Lấy dữ liệu hình ảnh từ canvas
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = Array.from(imageData.data);

            // Gửi dữ liệu hình ảnh lên server để phân loại
            const url = '/classify'; // Địa chỉ endpoint phân loại
            fetch(url, {
                method: 'POST',
                body: JSON.stringify({ data: data }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(result => {
                // Hiển thị kết quả phân loại lên canvas
                ctx.font = '24px Arial';
                ctx.fillStyle = 'red';
                ctx.fillText(result.label, 10, 30);
                detect(); // Tiếp tục đoán trên các khung hình tiếp theo
            })
            .catch(error => {
                console.error('Error classifying:', error);
            });
        }

        // Bắt đầu video và phát hiện
        startVideo();
    </script>
</body>
</html>
